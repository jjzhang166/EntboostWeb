/*! entboost messenger jquery plugin - v0.1.0 - 2015-04-11
* https://github.com/Administrator/jqEBMessenger
* Copyright (c) 2015 ; Licensed MIT */
!function($,window,undefined){!function($){var escape=/["\\\x00-\x1f\x7f-\x9f]/g,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},hasOwn=Object.prototype.hasOwnProperty;$.toJSON="object"==typeof JSON&&JSON.stringify?JSON.stringify:function(o){if(null===o)return"null";var pairs,k,name,val,type=$.type(o);if("undefined"===type)return undefined;if("number"===type||"boolean"===type)return String(o);if("string"===type)return $.quoteString(o);if("function"==typeof o.toJSON)return $.toJSON(o.toJSON());if("date"===type){var month=o.getUTCMonth()+1,day=o.getUTCDate(),year=o.getUTCFullYear(),hours=o.getUTCHours(),minutes=o.getUTCMinutes(),seconds=o.getUTCSeconds(),milli=o.getUTCMilliseconds();return 10>month&&(month="0"+month),10>day&&(day="0"+day),10>hours&&(hours="0"+hours),10>minutes&&(minutes="0"+minutes),10>seconds&&(seconds="0"+seconds),100>milli&&(milli="0"+milli),10>milli&&(milli="0"+milli),'"'+year+"-"+month+"-"+day+"T"+hours+":"+minutes+":"+seconds+"."+milli+'Z"'}if(pairs=[],$.isArray(o)){for(k=0;k<o.length;k++)pairs.push($.toJSON(o[k])||"null");return"["+pairs.join(",")+"]"}if("object"==typeof o){for(k in o)if(hasOwn.call(o,k)){if(type=typeof k,"number"===type)name='"'+k+'"';else{if("string"!==type)continue;name=$.quoteString(k)}type=typeof o[k],"function"!==type&&"undefined"!==type&&(val=$.toJSON(o[k]),pairs.push(name+":"+val))}return"{"+pairs.join(",")+"}"}},$.evalJSON="object"==typeof JSON&&JSON.parse?JSON.parse:function(str){return eval("("+str+")")},$.secureEvalJSON="object"==typeof JSON&&JSON.parse?JSON.parse:function(str){var filtered=str.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"");if(/^[\],:{}\s]*$/.test(filtered))return eval("("+str+")");throw new SyntaxError("Error parsing JSON, source is not valid.")},$.quoteString=function(str){return str.match(escape)?'"'+str.replace(escape,function(a){var c=meta[a];return"string"==typeof c?c:(c=a.charCodeAt(),"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16))})+'"':'"'+str+'"'}}(jQuery),function($,window){window.text_area_log=function(text){if(window.console&&console.info(text),$("#log_area").length>0){var logTextArea=$("#log_area")[0];logTextArea.value=logTextArea.value+text+"\n",logTextArea.scrollTop=logTextArea.scrollHeight}},$.ebfn||($.ebfn={}),$.extend($.ebfn,{htmlDecode:function(str){var s="";return 0===str.length?"":(s=str.replace(/&#38;/g,"&"),s=s.replace(/&lt;/g,"<"),s=s.replace(/&gt;/g,">"),s=s.replace(/&nbsp;/g," "),s=s.replace(/&#39;/g,"'"),s=s.replace(/&quot;/g,'"'),s=s.replace(/<br>/g,"\n"))},htmlEncode:function(str){var s="";return 0===str.length?"":(s=str.replace(/&/gm,"&#38;"),s=s.replace(/</gm,"&lt;"),s=s.replace(/>/gm,"&gt;"),s=s.replace(/\'/gm,"&#39;"),s=s.replace(/\"/gm,"&quot;"),s=s.replace(/[\n\r]+?/gm,"<br>"))},dateFormat:function(dateVar,format){var o={"M+":dateVar.getMonth()+1,"d+":dateVar.getDate(),"h+":dateVar.getHours(),"m+":dateVar.getMinutes(),"s+":dateVar.getSeconds(),"q+":Math.floor((dateVar.getMonth()+3)/3),S:dateVar.getMilliseconds()};/(y+)/.test(format)&&(format=format.replace(RegExp.$1,(dateVar.getFullYear()+"").substr(4-RegExp.$1.length)));for(var k in o)new RegExp("("+k+")").test(format)&&(format=format.replace(RegExp.$1,1==RegExp.$1.length?o[k]:("00"+o[k]).substr((""+o[k]).length)));return format},stringByteLength:function(str){var cArr=str.match(/[^\x00-\xff]/gi);return str.length+(null==cArr?0:cArr.length)},clone:function(obj){var o;if("object"==typeof obj)if(null===obj)o=null;else if(obj instanceof Array){o=[];for(var i=0,len=obj.length;len>i;i++)o.push(this.clone(obj[i]))}else{o={};for(var j in obj)o[j]=this.clone(obj[j])}else o=obj;return o},getServerName:function(url){var domain=url.match("^(?:(?:https?|ftp):)/*(?:[^@]+@)?([^:/#]+)");return domain[1]},getQueryStringRegExp:function(url,name){var reg=new RegExp("(^|\\?|&)"+name+"=([^&]*)(\\s|&|$)","i");return reg.test(url)?unescape(RegExp.$2.replace(/\+/g," ")):""},replaceDivTag:function(htmlSrc){if(!htmlSrc)return null;for(var regexp=new RegExp("<div\\s*[^<>]*>([^<>]*?(<img\\s*[^<>]*?[/]*>+[^<>]*(</img>)*)*?)*?</div>","i"),retHtml=[],index=-1,arrMactches=null,temp="";htmlSrc.length;)index=htmlSrc.search(regexp),arrMactches=htmlSrc.match(regexp),index>=0?(0!==index&&retHtml.push(htmlSrc.substring(0,index)),retHtml.push("\n"),temp=htmlSrc.substring(index,index+arrMactches[0].length),temp=$(temp).html(),retHtml.push(temp),htmlSrc=htmlSrc.substring(index+arrMactches[0].length)):(retHtml.push(htmlSrc),htmlSrc="");return retHtml.join("")},html2ArraySplitByImgTag:function(htmlData){for(var re=/<img\s*[^<>]*?[\/]*>+[^<>]*?(<\/img>)*/i,ary=[];htmlData.length;){var index=htmlData.search(re),arrMactches=htmlData.match(re);index>=0?(index&&ary.push(htmlData.substring(0,index)),ary.push(htmlData.substring(index,index+arrMactches[0].length)),htmlData=htmlData.substring(index+arrMactches[0].length)):(ary.push(htmlData),htmlData="")}return ary},richArray2Json:function(ary){var rich_info=[];rich_info.push("{");for(var i=0;i<ary.length;i++){if(ary[i].indexOf("<img")>-1||ary[i].indexOf("<IMG")>-1)rich_info.push(['"res":"',$(ary[i]).attr("resid"),";",$(ary[i]).attr("cmserver"),";",$(ary[i]).attr("appname"),";",$(ary[i]).attr("desc"),'"'].join(""));else{var content=ary[i],obj=$("<div></div>");obj.html(content),rich_info.push('"text":'+$.toJSON(obj.text()))}i<ary.length-1&&rich_info.push(",")}return rich_info.push("}"),rich_info.join("")}})}(jQuery,window),function(global){var buffer,_Base64=global.Base64,version="2.1.4";"undefined"!=typeof module&&module.exports&&(buffer=require("buffer").Buffer);var b64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64tab=function(bin){for(var t={},i=0,l=bin.length;l>i;i++)t[bin.charAt(i)]=i;return t}(b64chars),fromCharCode=String.fromCharCode,cb_utob=function(c){var cc;return c.length<2?(cc=c.charCodeAt(0),128>cc?c:2048>cc?fromCharCode(192|cc>>>6)+fromCharCode(128|63&cc):fromCharCode(224|cc>>>12&15)+fromCharCode(128|cc>>>6&63)+fromCharCode(128|63&cc)):(cc=65536+1024*(c.charCodeAt(0)-55296)+(c.charCodeAt(1)-56320),fromCharCode(240|cc>>>18&7)+fromCharCode(128|cc>>>12&63)+fromCharCode(128|cc>>>6&63)+fromCharCode(128|63&cc))},re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,utob=function(u){return u.replace(re_utob,cb_utob)},cb_encode=function(ccc){var padlen=[0,2,1][ccc.length%3],ord=ccc.charCodeAt(0)<<16|(ccc.length>1?ccc.charCodeAt(1):0)<<8|(ccc.length>2?ccc.charCodeAt(2):0),chars=[b64chars.charAt(ord>>>18),b64chars.charAt(ord>>>12&63),padlen>=2?"=":b64chars.charAt(ord>>>6&63),padlen>=1?"=":b64chars.charAt(63&ord)];return chars.join("")},btoa=global.btoa?function(b){return global.btoa(b)}:function(b){return b.replace(/[\s\S]{1,3}/g,cb_encode)},_encode=buffer?function(u){return new buffer(u).toString("base64")}:function(u){return btoa(utob(u))},encode=function(u,urisafe){return urisafe?_encode(u).replace(/[+\/]/g,function(m0){return"+"==m0?"-":"_"}).replace(/=/g,""):_encode(u)},encodeURI=function(u){return encode(u,!0)},re_btou=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),cb_btou=function(cccc){switch(cccc.length){case 4:var cp=(7&cccc.charCodeAt(0))<<18|(63&cccc.charCodeAt(1))<<12|(63&cccc.charCodeAt(2))<<6|63&cccc.charCodeAt(3),offset=cp-65536;return fromCharCode((offset>>>10)+55296)+fromCharCode((1023&offset)+56320);case 3:return fromCharCode((15&cccc.charCodeAt(0))<<12|(63&cccc.charCodeAt(1))<<6|63&cccc.charCodeAt(2));default:return fromCharCode((31&cccc.charCodeAt(0))<<6|63&cccc.charCodeAt(1))}},btou=function(b){return b.replace(re_btou,cb_btou)},cb_decode=function(cccc){var len=cccc.length,padlen=len%4,n=(len>0?b64tab[cccc.charAt(0)]<<18:0)|(len>1?b64tab[cccc.charAt(1)]<<12:0)|(len>2?b64tab[cccc.charAt(2)]<<6:0)|(len>3?b64tab[cccc.charAt(3)]:0),chars=[fromCharCode(n>>>16),fromCharCode(n>>>8&255),fromCharCode(255&n)];return chars.length-=[0,0,2,1][padlen],chars.join("")},atob=global.atob?function(a){return global.atob(a)}:function(a){return a.replace(/[\s\S]{1,4}/g,cb_decode)},_decode=buffer?function(a){return new buffer(a,"base64").toString()}:function(a){return btou(atob(a))},decode=function(a){return _decode(a.replace(/[-_]/g,function(m0){return"-"==m0?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},noConflict=function(){var Base64=global.Base64;return global.Base64=_Base64,Base64};if(global.Base64={VERSION:version,atob:atob,btoa:btoa,fromBase64:decode,toBase64:encode,utob:utob,encode:encode,encodeURI:encodeURI,btou:btou,decode:decode,noConflict:noConflict},"function"==typeof Object.defineProperty){var noEnum=function(v){return{value:v,enumerable:!1,writable:!0,configurable:!0}};global.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",noEnum(function(){return decode(this)})),Object.defineProperty(String.prototype,"toBase64",noEnum(function(urisafe){return encode(this,urisafe)})),Object.defineProperty(String.prototype,"toBase64URI",noEnum(function(){return encode(this,!0)}))}}}(jQuery,window),function($,window){window.IfrMessenger=function(){function Target(target,name){var errMsg="";if(arguments.length<2?errMsg="target error - target and name are both requied":"object"!=typeof target?errMsg="target error - target itself must be window object":"string"!=typeof name&&(errMsg="target error - target name must be string type"),errMsg)throw new Error(errMsg);this.target=target,this.name=name}function IfrMessenger(name){this.targets={},this.name=name,this.listenFunc=[],this.initListen()}var prefix="eb_messenger",supportPostMessage="postMessage"in window;return Target.prototype.send=supportPostMessage?function(msg){this.target.postMessage(prefix+msg,"*")}:function(msg){var targetFunc=window.navigator[prefix+this.name];if("function"!=typeof targetFunc)throw new Error("target callback function is not defined");targetFunc(prefix+msg,window)},IfrMessenger.prototype.addTarget=function(target,name){var targetObj=new Target(target,name);this.targets[name]=targetObj},IfrMessenger.prototype.initListen=function(){var self=this,generalCallback=function(msg){"object"==typeof msg&&msg.data&&(msg=msg.data),msg=msg.slice(prefix.length);for(var i=0;i<self.listenFunc.length;i++)self.listenFunc[i](msg)};supportPostMessage?"addEventListener"in document?window.addEventListener("message",generalCallback,!1):"attachEvent"in document&&window.attachEvent("onmessage",generalCallback):window.navigator[prefix+this.name]=generalCallback},IfrMessenger.prototype.listen=function(callback){this.listenFunc.push(callback)},IfrMessenger.prototype.clear=function(){this.listenFunc=[]},IfrMessenger.prototype.send=function(msg){var target,targets=this.targets;for(target in targets)targets.hasOwnProperty(target)&&targets[target].send(msg)},IfrMessenger}()}(jQuery,window)}(jQuery,window);
/*! jqEBMessenger 最后修改于： 2015-04-11 */