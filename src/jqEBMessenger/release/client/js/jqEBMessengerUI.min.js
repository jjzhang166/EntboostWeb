/*! entboost messenger jquery plugin - v0.1.0 - 2014-11-07
* https://github.com/Administrator/jqEBMessenger
* Copyright (c) 2014 ; Licensed MIT */
!function($,window,undefined){!function(window,$){var jqEBM=$.jqEBMessenger;jqEBM.UI||(jqEBM.UI={}),$.ebMsg.UI=jqEBM.UI;var ebUI=jqEBM.UI;ebUI.MESSAGE_TYPE_ATTACHMENT=2,ebUI.MESSAGE_TYPE_ME=1,ebUI.MESSAGE_TYPE_OUTSIDE=0,ebUI.MESSAGE_TYPE_SYSTIPS=-1,ebUI.cusorPosMap={},window.clear_text_area_log=function(){if($("#log_area").length>0){var logTextArea=$("#log_area")[0];logTextArea.value="",logTextArea.scrollTop=logTextArea.scrollHeight}},window.openEBHOMEWin=function(){window.open("http://www.entboost.com","恩布官方网站","width=1366,height=768,top=0,left=0,toolbar=yes,menubar=yes,scrollbars=yes, resizable=yes,location=yes, status=yes")},ebUI.saveCusorPos=function(iframe){if(iframe.focus(),iframe.document.selection){var rangeObj=iframe.document.selection.createRange(),ieSelectionBookMark=rangeObj.getBookmark();ebUI.cusorPosMap[iframe.name]=ieSelectionBookMark}},ebUI.setCusorPos=function(iframe){iframe.focus();var ieSelectionBookMark=ebUI.cusorPosMap[iframe.name];if(ieSelectionBookMark){var rangeObj=iframe.document.selection.createRange();rangeObj.moveToBookmark(ieSelectionBookMark),rangeObj.select()}},ebUI.ctrlEnter=function(btns,iframe_name,fn){function performAction(e){fn.call(thiz,e)}btns=$(btns);var thiz=this,tframe=document.getElementById(iframe_name).contentWindow||document.frames[iframe_name][0],doc=tframe.document;$(doc.body).bind("keydown",function(e){/msie/.test(jqEBM.AGENT)&&ebUI.saveCusorPos(tframe),$.CancelFlashTip(),13===e.keyCode&&e.ctrlKey&&(performAction(e),e.preventDefault())}),btns.bind("click",performAction)},ebUI.addClickLink=function(call_id,tips,click_name,click_handle_str){var sysTip=[tips,'<a href="###" onclick="',click_handle_str,'">',click_name,"<a>"].join("");$.ShowSysTips(call_id,sysTip)},ebUI.showSurface=function(call_id,from_uid,from_account,userName,sysTip){0===$("body").find("div[class=chat-main][id="+call_id+"]").length?($.WebIM({callId:call_id,sender:jqEBM.clientInfo.username,receiver:from_account,userName:userName},function(){sysTip&&sysTip.length>0&&$.ShowSysTips(call_id,sysTip)}),$("#loading_message").remove(),$("#loading_img").remove(),$("#"+call_id).show(500)):($.ShowSysTips(call_id,sysTip),text_area_log("callId="+call_id+" 已存在，重用界面"))},ebUI.logon=function(){$.ebMsg.logonVisitor(ebUI.onLogonSuccess,function(error){alert(error.code+" : "+error.msg)})},ebUI.callAccountsOfChat=function(callId){for(var callInfo=ebUI.callInfoMap[callId],uids=callInfo.getUids(),i=0;i<uids.length;i++){var uid=uids[i],accountInfo=ebUI.accountInfoMap[uid];$.ebMsg.callAccount(accountInfo.from_account,callId,callInfo.call_key,ebUI.onCallAccountSuccess,ebUI.callAccountFailureCallback)}},ebUI.onLogonSuccess=function(clientInfo){ebUI.clientInfo=clientInfo;var callCount=0;for(var existCallId in ebUI.callInfoMap)callCount++,ebUI.callAccountsOfChat(existCallId);0===callCount&&(ebUI.to_account=$.ebfn.getQueryStringRegExp(document.location.href,"to_account"),ebUI.call_key=$.ebfn.getQueryStringRegExp(document.location.href,"call_key"),$.ebMsg.callAccount(ebUI.to_account,null,ebUI.call_key,ebUI.onCallAccountSuccess,ebUI.callAccountFailureCallback))},ebUI.onCallAccountSuccess=function(callInfo,accountInfo){ebUI.callInfoMap[callInfo.call_id]=callInfo,ebUI.accountInfoMap[accountInfo.uid]=accountInfo,ebUI.showSurface(callInfo.call_id,accountInfo.uid,accountInfo.from_account,accountInfo.fInfo.name,ebUI.recall_flag?"可以开始对话":null),ebUI.talkReadyMap[callInfo.call_id]=!0},ebUI.callAccountFailureCallback=function(error){var errCodeMap=jqEBM.errCodeMap;switch(error){case errCodeMap.CALLACCOUNT_NOT_EXIST:$("#loading_message").html("您呼叫的用户名并不存在<br/>请查验："+ebUI.to_account);break;case errCodeMap.CALLACCOUNT_NO_RESPONSE:$("#loading_message").append("对方没有应答通话请求");break;case errCodeMap.CALLACCOUNT_REJECT:$("#loading_message").append("对方拒绝通话请求");break;default:alert(error.code+" : "+error.msg)}$("#loading_img").remove()},ebUI.changeCallId=function(existCallId,newCallId){var chatEl=$("div[class=chat-main][id="+existCallId+"]");if(chatEl.length>0){chatEl.attr("id",newCallId),chatEl.attr("old_id",existCallId);var revEl=$("iframe[name=receiveMessage"+existCallId+"]");revEl.attr("name","receiveMessage"+newCallId),revEl.attr("id","receiveMessage"+newCallId);var sendEl=$("iframe[name=sendMessage"+existCallId+"]");sendEl.attr("name","sendMessage"+newCallId),sendEl.attr("id","sendMessage"+newCallId)}},ebUI.onLoadEmotions=function(emotions){if($.IM.defaultOptions.faceImageArray=[],emotions)for(var i=0;i<emotions.length;i++){var emotion=emotions[i],faceImage={snap:emotion.url,gif:emotion.url};$.IM.defaultOptions.faceImageArray.push(faceImage)}},ebUI.createShowPictureTag=function(url,targetWidth,targetHeight){var image_url=['<img src="',url,'"'," onclick=\"window.open('",url,"')\"",' onload="adjustImgSize(this, '+targetWidth+","+targetHeight+');updateScroll();"',' style="cursor:pointer;"',"/>"].join("");return image_url},ebUI.processRichInfo=function(richInfo){for(var htmlContent=[],info=null,i=0;i<richInfo.length;i++)switch(info=richInfo[i],info.type){case"text":htmlContent.push($.ebfn.htmlEncode(info.content));break;case"screenshot":htmlContent.push(ebUI.createShowPictureTag(info.content,350,200));break;case"emotion":htmlContent.push('<img src="'+info.content+'"/>')}return htmlContent.join("")},ebUI.onSendingFile=function(state,callId,fileName,mimeType,url){var chatEl=$("body").find("div[class=chat-main][id="+callId+"]"),file=chatEl.find("#attachment_file")[0],errCodeMap=jqEBM.errCodeMap;switch(state){case errCodeMap.SENDFILE_REQUEST_FAILURE:$.ShowSysTips(callId,"<span style='color:red;'>申请上传文件失败。</span>");break;case errCodeMap.UPLOAD_FILE_EMPTY:$.ShowSysTips(callId,"<span style='color:red;'>上传文件失败，请先选择一个文件后再点击传送。</span>");break;case errCodeMap.CONTENT_TOO_LONG:$.IM.defaultOptions.resetUploadAttachment(),chatEl.find("#upfile").val(""),file.outerHTML+="",file.value="",$.ShowSysTips(callId,"<span style='color:red;'>很抱歉！上传失败，文件超过最大限制(1MB-兆字节)。</span>");break;case errCodeMap.OK:chatEl.find("#upfile").val(""),file.outerHTML+="",file.value="";var spls=fileName.split("\\"),showHtml=["服务器已经成功保存离线文件。<br/> <span style='color: blue;'>",spls[spls.length-1],"</span>"];if(jqEBM.pictureMimeTypeMap[mimeType]){var image_url=ebUI.createShowPictureTag(url,400,200);showHtml.push("<br/>"),showHtml.push(image_url),text_area_log(image_url)}$.ShowSysTips(callId,showHtml.join(""))}$.IM.defaultOptions.resetUploadAttachment()},ebUI.onSentFile=function(state,callId,fileName){var spls=fileName.split("\\");fileName=spls[spls.length-1];var errCodeMap=jqEBM.errCodeMap;switch(state){case errCodeMap.OK:$.ShowSysTips(callId,"对方已经成功接收到文件。<br/> <span style='color: blue;'>"+fileName+"</span>");break;case errCodeMap.UPLOAD_FILE_REJECT:$.ShowSysTips(callId,"对方<span style='color:red;font-weight:bold;'>拒绝</span>接收文件。<br/> <span style='color:red;'>"+fileName+"</span>")}}}(window,jQuery),function(window,$){window.sendMessageEditor={getWin:function(){return window.frames[this.iframe.name]},getDoc:function(){return/firefox/.test($.jqEBMessenger.AGENT)?this.iframe.contentDocument||this.getWin().document:this.getWin().document},init:function(){var doc=this.getDoc();/msie/.test($.jqEBMessenger.AGENT)?(doc.body.contentEditable="true",$(doc.body).html("<div></div>")):doc.designMode="on",text_area_log("开启编辑模式="+doc.designMode)},getContent:function(){var doc=this.getDoc(),body=doc.body||doc.documentElement,content=body.innerHTML;return content},execCmd:function(cmd,value,d){var doc=d||this.getDoc();doc.execCommand(cmd,!1,value===undefined?null:value)},getStyleState:function(cmd){var doc=this.getDoc(),state=doc.queryCommandState(cmd);return state},insertAtCursor:function(text,d,w){var doc=d||this.getDoc(),win=w||this.getWin();if(/msie/.test($.jqEBMessenger.AGENT)){$.jqEBMessenger.UI.setCusorPos(win);var r=doc.selection.createRange();r&&(r.collapse(!1),r.pasteHTML(text),r.select(),r.collapse(!1),$.jqEBMessenger.UI.saveCusorPos(win))}else/gecko/.test($.jqEBMessenger.AGENT)||/opera/.test($.jqEBMessenger.AGENT)?(win.focus(),this.execCmd("InsertHTML",text,doc)):/safari/.test($.jqEBMessenger.AGENT)&&this.execCmd("InsertText",text,doc)}}}(window,jQuery),function(window,$){var jqEBM=$.jqEBMessenger,ebUI=jqEBM.UI,sendMessageEditor=window.sendMessageEditor,_im=$.IM={};_im.version=2;var faceTimed,messageTipTimed,tipCount=0,loadSendIframeTimes=0;_im.defaultOptions={chat:"#chat",chatEl:function(){var $chat=_im.defaultOptions.chat;return"string"==typeof _im.defaultOptions.chat?$chat=$(_im.defaultOptions.chat):"object"==typeof _im.defaultOptions.chat&&($chat.get(0)||($chat=$($chat))),$chat},sendMessageIFrame:function(callId){return $("iframe[name='sendMessage"+callId+"']").get(0).contentWindow},receiveMessageDoc:function(callId){callId=callId||"";var docs=[];return $.each($("iframe[name^='receiveMessage"+callId+"']"),function(){docs.push($(this.contentWindow.document))}),docs},setTitle:function(chatEl){var userName=chatEl.attr("userName");chatEl.find(".title").html("和 "+userName+" 聊天对话中")},getReceiver:function(chatEl){var receiver=chatEl.attr("receiver");return~receiver.indexOf("@")&&(receiver=receiver.split("@")[0]),receiver},receiveMessageTpl:function(userName,styleTpl,content,type){var datetime=$.ebfn.dateFormat(new Date,"hh:mm:ss"),result=['<div class="revMsg_box">'],img_l='<div class="head_img img_l"><img src="images2/g1.jpg"></div>',img_r='<div class="head_img img_r"><img src="images2/g2.png"></div>';return type==ebUI.MESSAGE_TYPE_ME?(result.push(img_r),result.push('<div class="talk_tail tail_r"><img src="images2/talk-r.gif"></div>'),result.push(['<div class="msg msg_r"><div class="content">',content,'</div><div class="date_time">',datetime,"</div></div>"].join(""))):type==ebUI.MESSAGE_TYPE_OUTSIDE?(result.push(img_l),result.push('<div class="talk_tail tail_l"><img src="images2/talk-l.gif"></div>'),result.push(['<div class="msg msg_l"><div class="content">',content,'</div><div class="date_time">',datetime,"</div></div>"].join(""))):result.push(type==ebUI.MESSAGE_TYPE_ATTACHMENT?['<div class="attachment"><div>',content,"</div></div>"].join(""):['<div class="sys_tips"><div>',content,"</div></div>"].join("")),result.push('<div id="clearFloat" style="clear:both;"></div>'),result.push("</div>"),result.join("")},sendMessageStyle:{cssStyle:{bold:"font-weight: bold;",underline:"text-decoration: underline;",italic:"font-style: oblique;"},setStyle:function(style,val){if(val)_im.defaultOptions.sendMessageStyle[style]=val;else{var styleVal=_im.defaultOptions.sendMessageStyle[style];_im.defaultOptions.sendMessageStyle[style]=styleVal!==undefined&&styleVal?!1:!0}},getStyleTpl:function(){var tpl="";return $.each(_im.defaultOptions.sendMessageStyle,function(style,item){item===!0?tpl+=_im.defaultOptions.sendMessageStyle.cssStyle[style]:"string"==typeof item&&(tpl+=style+":"+item+";")}),tpl}},writeReceiveMessage:function(callId,userName,content,type){if(content){var styleTpl=_im.defaultOptions.sendMessageStyle.getStyleTpl(),receiveMessageDoc=_im.defaultOptions.receiveMessageDoc(callId);$.each(receiveMessageDoc,function(){this.find("body").append(_im.defaultOptions.receiveMessageTpl(userName,styleTpl,content,type)),text_area_log("send content==\n"+content),this.scrollTop(this.height())})}},sendHandler:function($chatMain){var callId=$chatMain.attr("id");if(!ebUI.talkReadyMap[callId])return void $.ShowSysTips(callId,"<span style='color:red'>当前状态不能进行通话</span>");var doc=$chatMain.find("iframe[name^='sendMessage']").get(0).contentWindow.document,content=$(doc.body).html(),trimContent=content.replace(/<br>/gi,"\n");0!==$.trim(trimContent).length&&(trimContent=trimContent.replace(/<div>\s*<\/div>|<div\s*\/>/gi,"\n"),trimContent=$.trim(trimContent),trimContent&&trimContent.length>0&&$.jqEBMessenger.api.sendMessage(callId,trimContent,function(){_im.defaultOptions.writeReceiveMessage(callId,"自己",content,ebUI.MESSAGE_TYPE_ME),$(doc.body).html(/msie/.test($.jqEBMessenger.AGENT)?"<div></div>":"")},function(state){state==$.jqEBMessenger.errCodeMap.NOT_LOGON?ebUI.addClickLink(callId,"会话已经暂时结束。","重新对话","reloadLogon(this);"):alert("发送失败,"+state.msg)}))},faceImagePath:"images/emotions/",faceImageArray:[],faceElTpl:function(i){return["<img "," src='",_im.defaultOptions.faceImageArray[i].snap,"' gif='",_im.defaultOptions.faceImageArray[i].gif,"'/>"].join("")},createFaceElement:function($chat){for(var faces=[],i=1;i<=_im.defaultOptions.faceImageArray.length;i++)faces.push(this.faceElTpl(i-1)),i%13===0&&faces.push("<br/>");var lastE=13-(i%13===0?13:i%13);for(i=0;lastE>=i;i++)faces.push("<img src='images/blank.gif'/>");$chat.find("#face").html(faces.join("")),this.faceHandler($chat)},faceHandler:function($chat){$chat.find("#face img").click(function(){$chat.find("#face").hide(150);var imgEL=["<img src='",$(this).attr("gif"),"'/>"].join(""),$chatMain=$(this).parents(".chat-main"),win=$chatMain.find("iframe[name^='sendMessage']").get(0).contentWindow,doc=win.document;sendMessageEditor.insertAtCursor(imgEL,doc,win)}),$chat.find("#face, #face img").mouseover(function(){window.clearTimeout(faceTimed)}).mouseout(function(){window.clearTimeout(faceTimed),faceTimed=window.setTimeout(function(){$chat.find("#face").hide(150)},2e3)})},toolBarHandler:function(){var $chat=$(this).parents(".chat-main"),targetCls=$(this).attr("class");"face"==targetCls?$chat.find("#face").toggle(150):"attachment"==targetCls?$chat.find("#attachment").toggle():"DIV"==this.tagName?_im.defaultOptions.sendMessageStyle.setStyle(targetCls):"SELECT"==this.tagName&&(_im.defaultOptions.sendMessageStyle.setStyle($(this).attr("name"),$(this).val()),"color"==$(this).attr("name")&&$(this).css("background-color",$(this).val())),_im.defaultOptions.writeSendStyle()},writeSendStyle:function(){var styleTpl=_im.defaultOptions.sendMessageStyle.getStyleTpl(),styleEL=['<style type="text/css">body{',styleTpl,"}</style>"].join("");$("body").find("iframe[name^='sendMessage']").each(function(){var $head=$(this.contentWindow.document).find("head");$head.find("style").size()>1&&$head.find("style:gt(0)").remove(),styleTpl&&$head.append(styleEL)})},chatLayoutTemplate:function(callId,sender,receiver,userName,product,flag){var display="";return flag&&(display="style='display: none;'"),['<div class="chat-main" id="',callId,'" sender="',sender,'" receiver="',receiver,'" userName="',userName,'">','<div id="chat"><div class="radius">',"<table>","<tr>",'<td class="receive-message">','<iframe id="receiveMessage',callId,'" name="receiveMessage',callId,'" src="receiveMessagePage.html?v =',jqEBM.STATIC_VERSION,'" frameborder="0" width="100%" height="100%"></iframe>',"</td>",'<td rowspan="4" class="split-r split" ',display,">&nbsp;</td>",'<td rowspan="4" class="product-info" ',display,">",'<div class="logo"><img onclick="openEBHOMEWin()" src="images2/logo2.gif"></div>','<div class="product-name"><div>恩布互联</div></div>','<div class="product-description"><div><span>跨平台、跨应用的即时通信开放平台<br>联系电话：0755-27362216</span></div></div>',"</td>","</tr>",'<tr class="tool-bar">',"<td>",'<div class="face" TITLE="插入表情"></div>','<div class="attachment" TITLE="上传文件"></div>','<div class="history">消息记录</div>',"</td>","</tr>",'<tr class="send-message">',"<td>",'<iframe id="sendMessage'+callId+'" name="sendMessage',callId,'" width="100%" height="100px" frameborder="0" src="sendMessagePage.html?v=',jqEBM.STATIC_VERSION,'" onload="$.IM.defaultOptions.sendMessage_iframe_onload(this);"></iframe>',"</td>","</tr>",'<tr class="bottom-bar">',"<td>",'<div style="font-size: 12px;color: gray; text-align: right;">快捷键Ctrl+Enter</div><div id="send" onselectstart="return false;" class="send-btn btn solid blue" TITLE="快捷键Ctrl+Enter" >发送消息</div>',"</td>","</tr>","</table></div>",'<div id="face"></div>','<div id="attachment">','<div id="attachment_holder">','<input id="attachment_file" class="inline-block_cls" type="file" name="attachment_file" onchange="upfile.value=this.value;">','<input class="solid blue attachment_btn" type="button" value="浏览">',"</div>",'<input type="text" name="upfile" id="upfile">','<input class="solid blue attachment_btn" id="send_attachment" type="button" value="传送" >','<input class="solid blue attachment_btn" id="close_attachment" type="button" value="关闭" onclick="$(this).parent().hide(150);">','<img id="attachment_uploading" src="images/loading13.gif">',"</div>","</div>","</div>"].join("")},sendMessage_iframe_onload:function(ir){if(text_area_log("sendMessage_iframe_onload iframe name="+ir.name),0!==loadSendIframeTimes)return void text_area_log("发生了超过一次的iframe加载事件，忽略处理");loadSendIframeTimes++;var chatEl=$(ir).parents(".chat-main");sendMessageEditor.init(),this.setTitle(chatEl),this.writeSendStyle(),this.createFaceElement(chatEl),$(ir).ctrlEnter("#send",ir.name,function(){var cEl=this.parents(".chat-main");_im.defaultOptions.sendHandler(cEl)}),/msie/.test(jqEBM.AGENT)&&$(ir.contentWindow.document).bind("click",function(){ebUI.saveCusorPos(sendMessageEditor.iframe)}),chatEl.find(".more").click(function(){var $ul=$(this).parents("ul");$ul.find(".more").toggle(),$ul.find(".info").toggle(),$ul.find(".pic").toggle()}),chatEl.find(".split").toggle(function(){$(".product-info").hide(),$(this).parents(".radius").css("border-right-width","0px"),$(this).toggleClass("split-l"),$(this).toggleClass("split-r")},function(){$(".product-info").show(),$(this).parents(".radius").css("border-right-width","8px"),$(this).toggleClass("split-l"),$(this).toggleClass("split-r")}),chatEl.find(".tool-bar td").children().click(this.toolBarHandler),chatEl.find("#close").click(function(){var $chatMain=$(this).parents(".chat-main");$chatMain.hide(500)});var call_id=chatEl.attr("id"),call_info=jqEBM.chatMap[call_id],loadingImg=chatEl.find("#attachment_uploading"),sendAttachmentBtn=chatEl.find("#send_attachment"),upFileTxt=chatEl.find("#upfile");_im.defaultOptions.resetUploadAttachment=function(){sendAttachmentBtn.attr("disabled",!1);var attachmentFileInput_old=chatEl.find("#attachment_file");attachmentFileInput_old.css("display","inline-block"),attachmentFileInput_old.css("_display","inline"),upFileTxt.attr("readonly",!1),sendAttachmentBtn.removeAttr("batch_number"),loadingImg.css("display","none"),loadingImg.css("_display","none")},chatEl.find("#send_attachment").click(function(){if(!ebUI.talkReadyMap[call_id])return void $.ShowSysTips(call_id,"<span style='color:red'>当前状态不能上传文件</span>");var attachmentFileInput=chatEl.find("#attachment_file");if(""===attachmentFileInput.val())return void $.ShowSysTips(call_id,"<span style='color:red;'>请先选择一个文件后再点击传送。</span>");if(null!=sendAttachmentBtn.attr("batch_number"))return void $.ShowSysTips(call_id,"同一时间只允许上传一个文件。");sendAttachmentBtn.attr("disabled",!0),attachmentFileInput.css("display","none"),attachmentFileInput.css("_display","none"),upFileTxt.attr("readonly",!0),loadingImg.css("display","inline-block"),loadingImg.css("_display","inline");var batch_number=jqEBM.api.sendfile("attachment_file",call_info.chat_id,function(state,callId,fileName,mimeType,url){ebUI.onSendingFile(state,callId,fileName,mimeType,url)},function(state,callId,fileName){ebUI.onSentFile(state,callId,fileName)});sendAttachmentBtn.attr("batch_number",batch_number)}),$(ir.contentWindow.document).click(function(){_im.defaultOptions.cancelFlashTip()}),sendMessageEditor.initFinishedHandle&&setTimeout(function(){sendMessageEditor.initFinishedHandle()},1500),text_area_log("sendMessage_iframe_onload 加载完毕")},initWebIM:function(callId,receiver,userName,initFinishedHandle){var product={name:"小玩熊",pic:"images/sample.bmp",price:"198.00",marketPrice:"899.90",deliverOrgs:"EMS",wareHouses:"A库",skuAttrs:""},chatEl=$(_im.defaultOptions.chatLayoutTemplate(callId,_im.defaultOptions.sender,receiver,userName,product));chatEl.prependTo("body"),sendMessageEditor.iframe=this.sendMessageIFrame(callId),sendMessageEditor.initFinishedHandle=initFinishedHandle,setTimeout(function(){sendMessageEditor.iframe.focus()},1e3)},cancelFlashTip:function(){window.clearTimeout(messageTipTimed),document.title=client_title,tipCount=0},messageTip:function(){document.title=tipCount%2===0?"您来了新消息，请查收！":client_title,window.clearTimeout(messageTipTimed),messageTipTimed=window.setTimeout(_im.defaultOptions.messageTip,1500),tipCount++}},$.extend({WebIM:function(opts,initFinishedHandle){opts=opts||{},_im.defaultOptions=$.extend(_im.defaultOptions,_im.defaultOptions,opts);var settings=$.extend({},_im.defaultOptions,opts);settings.initWebIM(settings.callId,settings.receiver,settings.userName,initFinishedHandle)},ShowReceiveMsg:function(callId,userName,content){_im.defaultOptions.writeReceiveMessage(callId,userName,content,ebUI.MESSAGE_TYPE_OUTSIDE),_im.defaultOptions.messageTip()},ShowSysTips:function(callId,content){_im.defaultOptions.writeReceiveMessage(callId,"系统",content,ebUI.MESSAGE_TYPE_SYSTIPS)},CancelFlashTip:function(){_im.defaultOptions.cancelFlashTip()}})}(window,jQuery),function(window,$){var jqEBM=$.jqEBMessenger,ebUI=jqEBM.UI;ebUI.recall_flag=!1,ebUI.callInfoMap={},ebUI.accountInfoMap={},ebUI.clientInfo=null,ebUI.talkReadyMap={};var eventHandle=$.ebMsg.eventHandle;eventHandle.onLoadEmotions=function(emotions){ebUI.onLoadEmotions(emotions)},eventHandle.onReceiveMessage=function(callInfo,accountInfo,richInfo){var htmlStr=ebUI.processRichInfo(richInfo);$.ShowReceiveMsg(callInfo.call_id,accountInfo.fInfo.name,htmlStr)},eventHandle.onDisconnect=function(){for(var callId in ebUI.callInfoMap)ebUI.addClickLink(callId,"服务器断线，点击链接可再次上线。","再次上线","reloadLogon(this);")},eventHandle.onTalkOver=function(callId){ebUI.talkReadyMap[callId]=!1,$.ebMsg.offline(function(){for(var callId in ebUI.callInfoMap)ebUI.addClickLink(callId,"由于过长时间没有对话，因此当前已自动下线，点击链接可再次上线。","再次上线","reloadLogon(this);")},function(error){text_area_log("offline error, code ="+error.code,0/0+error.msg)})},eventHandle.onChangeCallId=function(existCallId,newCallId){ebUI.changeCallId(existCallId,newCallId)},eventHandle.onError=function(){}}(window,jQuery),function(window,$){var ebUI=$.ebMsg.UI;$.ebMsg.options.DOMAIN_URL="entboost.entboost.com";var IFRAME_DEBUG=$.ebfn.getQueryStringRegExp(document.location.href,"iframe_debug");!IFRAME_DEBUG||"true"!=IFRAME_DEBUG&&"TRUE"!=IFRAME_DEBUG||($.ebMsg.options.IFRAME_DEBUG=IFRAME_DEBUG),$(document).ready(function(){window.onbeforeunload=function(){return"该操作将放弃保存当前的消息内容"},window.onunload=function(){window.clear_text_area_log()},$(document).bind("click",function(){$.CancelFlashTip()}),$.fn.ctrlEnter=ebUI.ctrlEnter,ebUI.logon()})}(window,jQuery)}(jQuery,window);
/*! jqEBMessenger 最后修改于： 2014-11-07 */